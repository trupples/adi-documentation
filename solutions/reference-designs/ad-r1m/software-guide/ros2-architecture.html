<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta content="Overview" name="description" />

    <title>AD-R1M ROS2 Architecture &#8212; System Level Documentation  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8e8a900e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/app.min.css?v=85dade36" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../../_static/tabs.js?v=3ee01567"></script>
    <script async="async" src="../../../../_static/app.umd.js?v=3a4867e9"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <link rel="icon" href="../../../../_static/icon.svg"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="AD-R1M Advanced Usage" href="../advanced-usage.html" />
    <link rel="prev" title="AD-R1M ROS2 examples" href="ros2-examples.html" />
   
  
  
  <meta name="repository" content="documentation">
  <meta name="version" content="">
  
    <meta name="page_source_suffix" content=".rst">
  
  
  


<style>
  body {
    
  }

  body.dark {
    
  }

  @media (prefers-color-scheme: dark) {
    body:not(.light) {
      
    }
  }
</style>
  </head>
  
    <body>
  
  <input type="checkbox" id="input-show-toc">
  <input type="checkbox" id="input-show-localtoc">
  <input type="checkbox" id="input-show-repotoc">

  
  <div class="search-area">
    <form action="" method="get">
      <input type="text" name="q" aria-labelledby="search-documentation" value="" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="search" placeholder="Search"/>
      <button class="icon"></button>
    </form>
  </div>
  

  <header>
    <div id="left">
      <label id="show-sidebar" class="icon" for="input-show-toc" title="Show/hide index"></label>
    </div>
    <div id="right">
      <span>
        <a id="logo-org" href="https://analog.com" aria-label="Analog Devices Inc. landing page"></a>
        <div class="vertical-divider"></div>
        
        <label id="show-repotoc" for="input-show-repotoc" title="Show/hide docs" tabindex="0">Docs</label>
        
        <a id="logo" href="../../../../index.html">
          <div>System Level</div>
        </a>
      </span>
      <span class="reverse">
        <label id="show-localtoc" class="icon" for="input-show-localtoc" title="Show/hide contents"></label>
      </span>
    </div>
  </header>


  <div class="repotoc-tree overlay">
    <root>
  <a href="../../../../index.html" class="current">System Level</a>
</root>

  </div>
    <div class="localtoc">
      <div class="tocwrapper">
        <div class="header localtoc-header">
          <a id="scroll-up" href="#top-anchor" title="Back to top"></a>
        </div>
        <nav>
          <ul>
<li><a class="reference internal" href="#">AD-R1M ROS2 Architecture</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#system-architecture">System Architecture</a></li>
<li><a class="reference internal" href="#components">Components</a><ul>
<li><a class="reference internal" href="#drive-system-and-odometry">Drive System and Odometry</a><ul>
<li><a class="reference internal" href="#using-diff-drive-controller-odometry-directly-without-ekf">Using diff_drive_controller Odometry Directly (Without EKF)</a></li>
<li><a class="reference internal" href="#canopen-motor-control-integration">CANOpen Motor Control Integration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#imu-inertial-measurement-unit">IMU (Inertial Measurement Unit)</a></li>
<li><a class="reference internal" href="#time-of-flight-camera">Time-of-Flight Camera</a></li>
<li><a class="reference internal" href="#remote-control-interface">Remote Control Interface</a></li>
<li><a class="reference internal" href="#mapping-and-localization">Mapping and Localization</a></li>
<li><a class="reference internal" href="#autonomous-navigation">Autonomous Navigation</a></li>
<li><a class="reference internal" href="#high-level-control-commander-nodes">High-Level Control (Commander Nodes)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visualization-and-manual-control">Visualization and Manual Control</a><ul>
<li><a class="reference internal" href="#rviz-visualization">RViz Visualization</a></li>
<li><a class="reference internal" href="#manual-control">Manual Control</a></li>
</ul>
</li>
<li><a class="reference internal" href="#quick-start">Quick Start</a></li>
</ul>
</li>
</ul>

        </nav>
      </div>
    </div>

  
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
    <a id="no-logo" href="../../../../index.html">
      System Level Documentation
    </a><input id="input-switch-toc" type="checkbox">
<label id="show-repotoc" for="input-switch-toc">
All content
</label>
<label id="show-toc" for="input-switch-toc">
Content on this topic
</label>
<div class="repotoc-tree">
  <root>
  <a href="../../../../index.html" class="current">System Level</a>
</root>

</div>
<div class="toc-tree">
  <html>
  <body><p class="caption" role="heading"><span class="caption-text">Kuiper &amp; Linux Kernel</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1" id="toctree-collapse-1"/><div class="collapse"><a class="reference internal" href="../../../../linux/drivers/index.html">Linux drivers</a><label for="toctree-collapse-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1-1" id="toctree-collapse-1-1"/><div class="collapse"><a class="reference internal" href="../../../../linux/drivers/iio-adc/index.html">IIO ADC</a><label for="toctree-collapse-1-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../linux/drivers/iio-adc/ad4052/index.html">AD4052</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../linux/drivers/iio-adc/ad9084/index.html">AD9084/AD9088</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1-2" id="toctree-collapse-1-2"/><div class="collapse"><a class="reference internal" href="../../../../linux/drivers/iio-transceiver/index.html">IIO Transceivers</a><label for="toctree-collapse-1-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1-2-1" id="toctree-collapse-1-2-1"/><div class="collapse"><a class="reference internal" href="../../../../linux/drivers/iio-transceiver/adrv9009/index.html">ADRV9009, ADRV9008-1, ADRV9008-2</a><label for="toctree-collapse-1-2-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../linux/drivers/iio-transceiver/adrv9009/customization.html">Customization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-1-3" id="toctree-collapse-1-3"/><div class="collapse"><a class="reference internal" href="../../../../linux/drivers/iio/index.html">Linux Industrial I/O Subsystem</a><label for="toctree-collapse-1-3"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../linux/drivers/iio/iio-trig-sysfs.html">iio-trig-sysfs driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../linux/drivers/iio/iio-trig-bfin-timer.html">iio-trig-bfin-timer driver</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-2" id="toctree-collapse-2"/><div class="collapse"><a class="reference internal" href="../../../../linux/kernel/index.html">Kernel and devicetrees</a><label for="toctree-collapse-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kernel/zynq.html">Build Zynq</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kernel/zynqmp.html">Build ZynqMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kernel/microblaze.html">Build MicroBlaze</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-2-1" id="toctree-collapse-2-1"/><div class="collapse"><a class="reference internal" href="../../../../linux/kernel/petalinux.html">Build with Petalinux</a><label for="toctree-collapse-2-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-2-1-1" id="toctree-collapse-2-1-1"/><div class="collapse"><a class="reference internal" href="../../../../linux/kernel/petalinux-dts/index.html">Petalinux Device Trees</a><label for="toctree-collapse-2-1-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../linux/kernel/petalinux-dts/petalinux-custom-dts.html">Custom Device Trees with meta-adi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../linux/kernel/petalinux-dts/petalinux-meta-adi-bypass.html">Custom Device Trees with DTG (meta-adi Bypass)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../linux/kernel/petalinux-dts/petalinux-system-user.html">Device Tree Modifications with system-user.dtsi</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-3" id="toctree-collapse-3"/><div class="collapse"><a class="reference internal" href="../../../../linux/kuiper/index.html">Kuiper Linux</a><label for="toctree-collapse-3"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kuiper/release-notes.html">Release notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kuiper/sdcard/index.html">SD card flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kuiper/project-list.html">Project list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../linux/kuiper/update.html">Updating</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-4" id="toctree-collapse-4"/><div class="collapse"><a class="reference internal" href="../../../../software/iio-oscilloscope/index.html">IIO Oscilloscope</a><label for="toctree-collapse-4"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-4-1" id="toctree-collapse-4-1"/><div class="collapse"><a class="reference internal" href="../../../../software/iio-oscilloscope/adrv9009/index.html">ADRV9009</a><label for="toctree-collapse-4-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../software/iio-oscilloscope/adrv9009/plugin.html">Standard Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../software/iio-oscilloscope/adrv9009/advanced-plugin.html">Advanced plugin</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-5" id="toctree-collapse-5"/><div class="collapse"><a class="reference internal" href="../../../../software/libiio/index.html">Libiio</a><label for="toctree-collapse-5"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libiio/internals.html">About libiio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libiio/cli.html">Command line utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libiio/tips-tricks.html">Tips &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-6" id="toctree-collapse-6"/><div class="collapse"><a class="reference internal" href="../../../../software/libm2k/index.html">Libm2k</a><label for="toctree-collapse-6"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libm2k/calibration.html">Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libm2k/digital_communication.html">Digital communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/libm2k/m2kcli.html">Command line utility</a></li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-7" id="toctree-collapse-7"/><div class="collapse"><a class="reference internal" href="../../../../software/matlab/index.html">MATLAB &amp; Simulink Toolboxes</a><label for="toctree-collapse-7"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/matlab/hsx-toolbox/index.html">High Speed Converter Toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/matlab/transceiver-toolbox/index.html">Transceiver Toolbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/matlab/bsp-extend.html">Extending Device Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../software/pyadi-iio/index.html">PyADI-IIO</a></li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-8" id="toctree-collapse-8"/><div class="collapse"><a class="reference internal" href="../../../../software/zephyr/index.html">Zephyr RTOS</a><label for="toctree-collapse-8"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/zephyr/zephyr-devicetree.html">Intro to Devicetree</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/zephyr/kconfig/zephyr-kconfig.html">Introduction to Kconfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/zephyr/using-zephyr-codefusion-fs/zephyr_codefusion_fs.html">Using Zephyr &amp; Codefusion Studio to Partition a Flash Filesystem</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Evaluation Boards</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9" id="toctree-collapse-9"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/index.html">User guides</a><label for="toctree-collapse-9"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9-1" id="toctree-collapse-9-1"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/adc/ad4052-ardz/index.html">EVAL-AD4050/AD4052-ARDZ</a><label for="toctree-collapse-9-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../eval/user-guide/adc/ad4052-ardz/user-guide.html">Evaluating the device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../eval/user-guide/adc/ad9084-ebz/index.html">EVAL-AD9084-EBZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../eval/user-guide/mem/adxl355-pmdz/index.html">EVAL-ADXL355-PMDZ</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9-2" id="toctree-collapse-9-2"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9009/index.html">ADRV9009 &amp; ADRV9008</a><label for="toctree-collapse-9-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9009/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l3"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9-2-1" id="toctree-collapse-9-2-1"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9009/quickstart/index.html">Quickstart</a><label for="toctree-collapse-9-2-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9009/quickstart/zynqmp.html">ZCU102</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9009/basic-iq-datafiles.html">Basic IQ Datafiles</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9-3" id="toctree-collapse-9-3"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9026/index.html">ADRV9026 &amp; ADRV9029</a><label for="toctree-collapse-9-3"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9026/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l3"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-9-3-1" id="toctree-collapse-9-3-1"/><div class="collapse"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9026/quickstart/index.html">Quickstart</a><label for="toctree-collapse-9-3-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9026/quickstart/zynqmp.html">ZCU102</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../eval/user-guide/transceiver/adrv9026/quickstart/versal.html">VCK190</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Products &amp; Tools</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-10" id="toctree-collapse-10"/><div class="collapse"><a class="reference internal" href="../../../../tools/m2k/index.html">ADALM2000</a><label for="toctree-collapse-10"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/m2k/devs/index.html">For Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/m2k/users/index.html">For End Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/m2k/help_support.html">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/m2k/labview.html">Using With LabVIEW</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/m2k/matlab.html">Using with MATLAB</a></li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-11" id="toctree-collapse-11"/><div class="collapse"><a class="reference internal" href="../../../../tools/pluto-m2k/index.html">Common PLUTO&amp;M2K</a><label for="toctree-collapse-11"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/building_the_image.html">Building the Firmware Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/drivers.html">Installing Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/firmware.html">Firmware Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/obtaining_the_sources.html">Obtaining the Build Sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/reboot.html">Rebooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto-m2k/usb_otg_host.html">USB OTG – HOST function Support</a></li>
</ul>
</li>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-12" id="toctree-collapse-12"/><div class="collapse"><a class="reference internal" href="../../../../tools/pluto/index.html">ADALM-PLUTO</a><label for="toctree-collapse-12"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-12-1" id="toctree-collapse-12-1"/><div class="collapse"><a class="reference internal" href="../../../../tools/pluto/devs/index.html">For Developers</a><label for="toctree-collapse-12-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../tools/pluto/devs/usb_otg.html">USB OTG</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-12-2" id="toctree-collapse-12-2"/><div class="collapse"><a class="reference internal" href="../../../../tools/pluto/hacking/index.html">For Hackers</a><label for="toctree-collapse-12-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../tools/pluto/hacking/hardware.html">ADALM-PLUTO Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tools/pluto/hacking/listening_to_yourself.html">Self Reception</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../tools/pluto/hacking/power_amp.html">Controlling External Devices</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-12-3" id="toctree-collapse-12-3"/><div class="collapse"><a class="reference internal" href="../../../../tools/pluto/users/index.html">For End Users</a><label for="toctree-collapse-12-3"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../tools/pluto/users/antennas.html">Antennas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto/help_support.html">Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto/prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tools/pluto/transceiver_transferring_data.html">Controlling the transceiver and transferring data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/uartjtag/index.html">ADALM-UARTJTAG</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Apps &amp; Solutions</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../application-software/index.html">Application Software</a></li>
<li class="toctree-l1 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13" id="toctree-collapse-13" checked=""/><div class="collapse"><a class="reference internal" href="../../index.html">Reference Designs</a><label for="toctree-collapse-13"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-1" id="toctree-collapse-13-1"/><div class="collapse"><a class="reference internal" href="../../ad-acevsecrdset-sl/index.html">AD-ACEVSECRDSET-SL</a><label for="toctree-collapse-13-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-acevsecrdset-sl/hardware-guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-acevsecrdset-sl/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-2" id="toctree-collapse-13-2"/><div class="collapse"><a class="reference internal" href="../../ad-apard32690-sl/index.html">AD-APARD32690-SL</a><label for="toctree-collapse-13-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-apard32690-sl/ad-t1lusb-ebz/index.html">AD-T1LUSB2.0-EBZ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-apard32690-sl/nina-w102/index.html">NINA-W102 Networking Support</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-3" id="toctree-collapse-13-3"/><div class="collapse"><a class="reference internal" href="../../ad-bmse2e3w-sl/index.html">AD-BMSE2E3W-SL</a><label for="toctree-collapse-13-3"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-bmse2e3w-sl/sample_application/index.html">Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-bmse2e3w-sl/software_guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-4" id="toctree-collapse-13-4"/><div class="collapse"><a class="reference internal" href="../../ad-cellpackbm-sl/index.html">AD-CELLPACKBM-SL</a><label for="toctree-collapse-13-4"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-cellpackbm-sl/hardware_guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-cellpackbm-sl/software_guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ad-gmsl-d-e-adp/index.html">AD-GMSL-D-E-ADP#</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-5" id="toctree-collapse-13-5"/><div class="collapse"><a class="reference internal" href="../../ad-gmsl522-sl/index.html">AD-GMSL522-SL</a><label for="toctree-collapse-13-5"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-gmsl522-sl/hardware-guide/index.html">Hardware Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-gmsl522-sl/software-guide/index.html">Software Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ad-gmsl716mipi-evk/index.html">AD-GMSL716MIPI-EVK</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ad-gmsl717mipi-evk/index.html">AD-GMSL717MIPI-EVK</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-6" id="toctree-collapse-13-6"/><div class="collapse"><a class="reference internal" href="../../ad-gmslcamrpi-adp/index.html">AD-GMSLCAMRPI-ADP#</a><label for="toctree-collapse-13-6"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-gmslcamrpi-adp/amd-kria/index.html">Using with AMD Kria</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-gmslcamrpi-adp/nvidia-jetson/index.html">Using with Nvidia Jetson Orin Nano</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-gmslcamrpi-adp/raspberry-pi-user-guide/index.html">Using with Raspberry Pi</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-7" id="toctree-collapse-13-7"/><div class="collapse"><a class="reference internal" href="../../ad-paarray3552r-sl/index.html">AD-PAARRAY3552R-SL</a><label for="toctree-collapse-13-7"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-paarray3552r-sl/hardware-guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-paarray3552r-sl/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-8" id="toctree-collapse-13-8"/><div class="collapse"><a class="reference internal" href="../../ad-pqmon-sl/index.html">AD-PQMON-SL</a><label for="toctree-collapse-13-8"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-pqmon-sl/hardware-guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-pqmon-sl/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-9" id="toctree-collapse-13-9" checked=""/><div class="collapse"><a class="reference internal" href="../index.html">AD-R1M</a><label for="toctree-collapse-13-9"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../quick-start-guide.html">AD-R1M Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../use-cases.html">AD-R1M Use Case Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hardware-guide.html">AD-R1M Hardware Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../system-setup.html">AD-R1M System Setup</a></li>
<li class="toctree-l3 current"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-9-1" id="toctree-collapse-13-9-1" checked=""/><div class="collapse"><a class="reference internal" href="../software-guide.html">AD-R1M Software Guide</a><label for="toctree-collapse-13-9-1"><div class="icon"></div></label></div><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="ros2-getting-started.html">AD-R1M ROS 2 Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="ros2-examples.html">AD-R1M ROS2 examples</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">AD-R1M ROS2 Architecture</a></li>
</ul>
</li>
<li class="toctree-l3"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-9-2" id="toctree-collapse-13-9-2"/><div class="collapse"><a class="reference internal" href="../advanced-usage.html">AD-R1M Advanced Usage</a><label for="toctree-collapse-13-9-2"><div class="icon"></div></label></div><ul>
<li class="toctree-l4"><a class="reference internal" href="../advanced-usage/linux-system.html">AD-R1M Linux system structure (kernel, configs, services, docker)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../advanced-usage/ros2-writing-your-own-nodes.html">Writing your own ROS 2 nodes for AD-R1M</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html">AD-R1M Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-10" id="toctree-collapse-13-10"/><div class="collapse"><a class="reference internal" href="../../ad-swiot1l-sl/index.html">AD-SWIOT1L-SL</a><label for="toctree-collapse-13-10"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ad-swiot1l-sl/hardware-guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ad-swiot1l-sl/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-11" id="toctree-collapse-13-11"/><div class="collapse"><a class="reference internal" href="../../admv96s-wgbe-ek1/index.html">ADMV96S-WGBE-EK1</a><label for="toctree-collapse-13-11"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admv96s-wgbe-ek1/hardware-guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admv96s-wgbe-ek1/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-12" id="toctree-collapse-13-12"/><div class="collapse"><a class="reference internal" href="../../adrd3161/index.html">ADRD3161</a><label for="toctree-collapse-13-12"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/quick-start-guide.html">ADRD3161 Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/hardware-guide.html">ADRD3161 Hardware Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/software-guide.html">ADRD3161 Software Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/troubleshooting.html">ADRD3161 Troubleshooting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/canopen.html">ADRD3161 CANopen reference</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd3161/production-guide.html">ADRD3161 Production Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-13" id="toctree-collapse-13-13"/><div class="collapse"><a class="reference internal" href="../../adrd4161/index.html">ADRD4161</a><label for="toctree-collapse-13-13"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adrd4161/quick-start-guide.html">ADRD4161 Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd4161/hardware-guide.html">ADRD4161 Hardware Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd4161/software-guide.html">ADRD4161 Software Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-14" id="toctree-collapse-13-14"/><div class="collapse"><a class="reference internal" href="../../adrd5161/index.html">ADRD5161</a><label for="toctree-collapse-13-14"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../adrd5161/quick-start-guide.html">ADRD5161 Quick Start Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd5161/hardware-guide.html">ADRD5161 Hardware Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd5161/software-guide.html">ADRD5161 Software Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adrd5161/canopen.html">ADRD5161 CANopen reference</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../adrd8012-01Z/index.html">ADRD8012-01Z</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-15" id="toctree-collapse-13-15"/><div class="collapse"><a class="reference internal" href="../../eval-adbms6830bmsw/index.html">EVAL-ADBMS6830BMSW</a><label for="toctree-collapse-13-15"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../eval-adbms6830bmsw/software-guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-16" id="toctree-collapse-13-16"/><div class="collapse"><a class="reference internal" href="../../eval-cn0503-ardz/index.html">EVAL-CN0503-ARDZ</a><label for="toctree-collapse-13-16"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0503-ardz/cn0503-software/index.html">Software User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0503-ardz/fluorescence-measurement/index.html">Fluorescence Measurement Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0503-ardz/nitrate-measurement/index.html">Nitrate Measurement Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0503-ardz/pH-measurement/index.html">pH Measurement Demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0503-ardz/turbidity/index.html">Turbidity Measurement Demo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-cn0565-ardz/index.html">EVAL-CN0565-ARDZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-cn0575-rpiz/index.html">EVAL-CN0575-RPIZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-cn0577-fmcz/index.html">EVAL-CN0577-FMCZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-cn0581-ebz/index.html">EVAL-CN0581-EBZ</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-17" id="toctree-collapse-13-17"/><div class="collapse"><a class="reference internal" href="../../eval-cn0584-ebz/index.html">EVAL-CN0584-EBZ</a><label for="toctree-collapse-13-17"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0584-ebz/digital-template/index.html">Digital Template Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-cn0584-ebz/matlab-configuration/index.html">MATLAB Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-cn0585-fmcz/index.html">EVAL-CN0585-FMCZ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eval-ess1-sys/index.html">EVAL-ESS1-SYS</a></li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-18" id="toctree-collapse-13-18"/><div class="collapse"><a class="reference internal" href="../../eval-isomax/index.html">EVAL-ISOMAX</a><label for="toctree-collapse-13-18"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../eval-isomax/hardware_guide/index.html">Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-isomax/software_guide/index.html">Software User Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-13-19" id="toctree-collapse-13-19"/><div class="collapse"><a class="reference internal" href="../../eval-ltpa-kit/index.html">EVAL-LTPA-KIT (LTpowerAnalyzer Kit)</a><label for="toctree-collapse-13-19"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../eval-ltpa-kit/hardware_guide/index.html">EVAL-LTPA-KIT Hardware User Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../eval-ltpa-kit/software_guide/index.html">EVAL-LTPA-KIT Software Guide</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">University Program</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-14" id="toctree-collapse-14"/><div class="collapse"><a class="reference internal" href="../../../../university/index.html">Engineering University Program</a><label for="toctree-collapse-14"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-14-1" id="toctree-collapse-14-1"/><div class="collapse"><a class="reference internal" href="../../../../university/active_learning/index.html">Active Learning: Student-oriented Lab Exercises</a><label for="toctree-collapse-14-1"><div class="icon"></div></label></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../university/active_learning/wien_bridge_oscillator/index.html">Activity: The Wien Bridge Oscillator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../university/active_learning/efficiency_power_loss/index.html">Activity: Efficiency, Power Loss, and Thermal Management</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Learning</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-15" id="toctree-collapse-15"/><div class="collapse"><a class="reference internal" href="../../../../learning/index.html">Learning! Tutorials, Workshops, Etc</a><label for="toctree-collapse-15"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/tutorial_prec_adc/index.html">Precision ADC Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/converter_connectivity_tutorial/index.html">Converter Connectivity Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/sw_infrastructure/index.html">Software Infrastructure for designing with ADCs, DACs, and Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/tools_for_ls/index.html">Tools for Low Speed Mixed Signal System Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/tools_for_prec_wb/index.html">Tools for Precision Wideband Mixed Signal System Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/tools_for_hs/index.html">Tools for High-Speed Mixed Signal System Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshop_what_sw_for_sdr/index.html">What software do I need for my SDR?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshop_a_precision_converter_fpga_integration_journey/index.html">A Precision Converter FPGA Integration Journey</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshops_software_defined_instrumentation/index.html">Software Defined Instrumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshops_introduction_to_electronics/index.html">Introduction to Electronics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshops_embedded_baremetal/index.html">Embedded Baremetal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../learning/workshops_embedded_linux/index.html">Embedded Linux</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing and Guidelines</span></p>
<ul>
<li class="toctree-l1"><input class="toctree-collapse" type="checkbox" name="toctree-collapse-16" id="toctree-collapse-16"/><div class="collapse"><a class="reference internal" href="../../../../contributing/creating_new_pages.html">Creating new pages</a><label for="toctree-collapse-16"><div class="icon"></div></label></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../contributing/template/eval.html">Evaluation Boards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/docs_guidelines.html">Documentation guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/forking_publishing.html">Forking and publishing</a></li>
</ul>
</body>
</html>

</div>
        </div>
      </div>

  <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper" id="top-anchor">
          <div class="body-header">
  <nav class="breadcrumb"><ol><li><a href="../../index.html">Reference Designs</a></li><li><a href="../index.html">AD-R1M</a></li><li><a href="../software-guide.html">AD-R1M Software Guide</a></li></ol></nav>
</div>
          <div class="body" role="main">
            
  <section id="ad-r1m-ros2-architecture">
<h1>AD-R1M ROS2 Architecture<a class="headerlink" href="#ad-r1m-ros2-architecture" title="Link to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id3">Overview</a></p></li>
<li><p><a class="reference internal" href="#system-architecture" id="id4">System Architecture</a></p></li>
<li><p><a class="reference internal" href="#components" id="id5">Components</a></p>
<ul>
<li><p><a class="reference internal" href="#drive-system-and-odometry" id="id6">Drive System and Odometry</a></p></li>
<li><p><a class="reference internal" href="#imu-inertial-measurement-unit" id="id7">IMU (Inertial Measurement Unit)</a></p></li>
<li><p><a class="reference internal" href="#time-of-flight-camera" id="id8">Time-of-Flight Camera</a></p></li>
<li><p><a class="reference internal" href="#remote-control-interface" id="id9">Remote Control Interface</a></p></li>
<li><p><a class="reference internal" href="#mapping-and-localization" id="id10">Mapping and Localization</a></p></li>
<li><p><a class="reference internal" href="#autonomous-navigation" id="id11">Autonomous Navigation</a></p></li>
<li><p><a class="reference internal" href="#high-level-control-commander-nodes" id="id12">High-Level Control (Commander Nodes)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#visualization-and-manual-control" id="id13">Visualization and Manual Control</a></p>
<ul>
<li><p><a class="reference internal" href="#rviz-visualization" id="id14">RViz Visualization</a></p></li>
<li><p><a class="reference internal" href="#manual-control" id="id15">Manual Control</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#quick-start" id="id16">Quick Start</a></p></li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The AD-R1M ROS2 architecture enables the autonomous robot system, integrating CANOpen motor control, ADI Time-of-Flight (ToF) camera, IMU, and the ROS2 Navigation2 stack for 2D localization and navigation.</p>
</section>
<section id="system-architecture">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">System Architecture</a><a class="headerlink" href="#system-architecture" title="Link to this heading"></a></h2>
<pre  class="mermaid">
        graph TD
    K[Lift Server] &lt;--&gt;|/lift_cmd, /lift_state| J
    A[Drive System] --&gt;|/odom| F[Robot Localization]
    B[IMU] --&gt;|/imu| F
    C[ToF Camera] --&gt;|/cam1/depth_image| D[Depth to LaserScan]
    D --&gt;|/cam1/scan| I[Nav2 AMCL]
    F --&gt;|/odom_filtered| G[Navigation Stack]
    E[Remote Control] --&gt;|/cmd_vel_joy| H[Command Multiplexer]
    G --&gt;|/cmd_vel_nav| H
    H --&gt;|/cmd_vel| A
    I --&gt;|/amcl_pose| G
    I --&gt;|/amcl_pose| J[Demo Commander]
    J --&gt;|/goal_pose| G
    G --&gt;|/feedback| J
    G --&gt;|/status| J
    </pre></section>
<section id="components">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Components</a><a class="headerlink" href="#components" title="Link to this heading"></a></h2>
<section id="drive-system-and-odometry">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Drive System and Odometry</a><a class="headerlink" href="#drive-system-and-odometry" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>The robot uses multiple data sources for accurate positioning:</dt><dd><ul class="simple">
<li><p>Motor encoders → <cite>/diff_drive_controller/odom</cite></p></li>
<li><p>IMU measurements → <cite>/imu</cite></p></li>
<li><p>Fused data → <cite>/odom</cite> (via robot_localization)</p></li>
</ul>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start the drive system (specify CAN interface)</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_motors.launch.py<span class="w"> </span>can_iface:<span class="o">=</span>can0
</pre></div>
</div>
<p>This motor launch starts:</p>
<dl>
<dt><strong>controller_manager_node</strong></dt><dd><ul>
<li><p>Core ROS2 control component that manages and coordinates robot controllers. <a class="icon link reference external" href="https://control.ros.org/rolling/doc/ros2_control/controller_manager/doc/userdoc.html" target="_blank">controller_manager documentation</a></p></li>
<li><p>Loads and manages different controller plugins</p></li>
<li><p>Config: reads from <code class="docutils literal notranslate"><span class="pre">ros2_controllers.yaml</span></code> containing:</p>
<blockquote>
<div><ul class="simple">
<li><p>Controller configurations</p></li>
<li><p>Update rates</p></li>
<li><p>Controller interfaces</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
<ul class="simple">
<li><p>Supports both <code class="docutils literal notranslate"><span class="pre">diff_drive_controller</span></code> (default) and <code class="docutils literal notranslate"><span class="pre">forward_velocity_controller</span></code> for receiving velocity commands.</p></li>
<li><p>The active controller can be selected via the launch file (<code class="docutils literal notranslate"><span class="pre">controller:=forward_velocity_controller</span></code>) and configured in <code class="docutils literal notranslate"><span class="pre">ros2_controllers.yaml</span></code>.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># When launching just_motors.launch.py, choose between controllers:</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_motors.launch.py<span class="w"> </span>controller:<span class="o">=</span>&lt;type&gt;_controller<span class="w"> </span>can_iface:<span class="o">=</span>can0
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example controller configuration in ros2_controllers.yaml</span>
<span class="nt">diff_drive_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">diff_drive_controller/DiffDriveController</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">publish_rate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">left_wheel_names</span><span class="p">:</span>
<span class="w">    </span><span class="nt">right_wheel_names</span><span class="p">:</span>
<span class="w">    </span><span class="nt">wheel_separation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">wheel_radius</span><span class="p">:</span>

<span class="nt">forward_velocity_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">forward_command_controller/ForwardCommandController</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">joints</span><span class="p">:</span>
<span class="w">    </span><span class="nt">interface_name</span><span class="p">:</span>
</pre></div>
</div>
<ul class="simple">
<li><p>For more details, see the <a class="icon link reference external" href="https://control.ros.org/master/doc/ros2_controllers/diff_drive_controller/doc/userdoc.html" target="_blank">diff_drive_controller documentation</a> and <a class="icon link reference external" href="https://control.ros.org/master/doc/ros2_controllers/forward_command_controller/doc/userdoc.html" target="_blank">forward_velocity_controller documentation</a>.</p></li>
</ul>
<p><strong>robot_state_publisher</strong></p>
<blockquote>
<div><ul>
<li><p>Publishes the robot’s state (joint positions) to tf2</p></li>
<li><p>Computes forward kinematics and broadcasts the robot’s state</p></li>
<li><p>Config:</p>
<blockquote>
<div><ul class="simple">
<li><p>URDF model of the robot from <em>urdf</em> directory</p></li>
<li><p>Joint states from <em>/joint_states</em> topic</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<dl>
<dt><strong>controller_spawner</strong></dt><dd><ul class="simple">
<li><p>Utility to dynamically load and start controllers</p></li>
<li><p>Manages controller lifecycle (configured → active)</p></li>
</ul>
</dd>
<dt><strong>joint_state_broadcaster_spawner</strong></dt><dd><ul class="simple">
<li><p>Specialized spawner for the joint state broadcaster</p></li>
<li><p>Publishes joint states from hardware to <em>/joint_states</em> topic</p></li>
</ul>
</dd>
<dt><strong>robot_localization_node</strong></dt><dd><ul>
<li><p>Provides state estimation for robot pose</p></li>
<li><p>Fuses data from various sensors (IMU, odometry, etc.)</p></li>
<li><p>Config: Uses <code class="docutils literal notranslate"><span class="pre">ekf.yaml</span></code> containing:</p>
<blockquote>
<div><ul class="simple">
<li><p>Sensor inputs and frame IDs</p></li>
<li><p>Covariance matrices</p></li>
<li><p>Update frequencies</p></li>
<li><p>State estimation parameters</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
</dl>
<div class="smaller admonition">
<p class="admonition-title">Note</p>
<p>The robot_localization node is configured to use the <cite>/diff_drive_controller/odom</cite> topic for odometry data, which is published by the <cite>diff_drive_controller</cite>.
The EKF (Extended Kalman Filter) uses (X, Y) position, (X, Y) linear velocities, and Z angular velocity (vyaw):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">odom0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/diff_drive_controller/odom</span>
<span class="nt">odom0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># X, Y, Z position</span>
<span class="w">               </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">               </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># X, Y linear velocities</span>
<span class="w">               </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">    </span><span class="c1"># Z angular velocity (vyaw)</span>
<span class="w">               </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<section id="using-diff-drive-controller-odometry-directly-without-ekf">
<h4>Using diff_drive_controller Odometry Directly (Without EKF)<a class="headerlink" href="#using-diff-drive-controller-odometry-directly-without-ekf" title="Link to this heading"></a></h4>
<p>If you want to use the odometry published directly by the <cite>diff_drive_controller</cite> (without fusing with IMU data via the EKF), follow these steps:</p>
<ol class="arabic">
<li><dl>
<dt><strong>Disable the robot_localization_node</strong></dt><dd><p>In <cite>just_motors.launch.py</cite>, comment out or remove the <cite>robot_localization_node</cite> entry from the launch description:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
     <span class="n">decl_name</span><span class="p">,</span>
     <span class="n">decl_can_iface</span><span class="p">,</span>
     <span class="n">decl_config_dir</span><span class="p">,</span>
     <span class="n">decl_controller</span><span class="p">,</span>
     <span class="n">controller_manager_node</span><span class="p">,</span>
     <span class="n">robot_state_publisher</span><span class="p">,</span>
     <span class="n">controller_spawner</span><span class="p">,</span>
     <span class="n">joint_state_broadcaster_spawner</span><span class="p">,</span>
     <span class="c1"># robot_localization_node,  # &lt;-- Comment out or remove this line</span>
     <span class="n">twist_mux_node</span>
<span class="p">])</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Enable odom → base_link transform in diff_drive_controller</strong></dt><dd><p>In your <cite>ros2_controllers.yaml</cite>, set <cite>enable_odom_tf: true</cite> for the <cite>diff_drive_controller</cite>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">diff_drive_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">     </span><span class="nt">enable_odom_tf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># true: publish odom-&gt;base_link tf (set false if using EKF)</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><strong>Launch the drive system</strong></dt><dd><p>Start the drive system as usual:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_motors.launch.py<span class="w"> </span>can_iface:<span class="o">=</span>can0
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<p>With this setup, the robot will use the odometry and TF published by the <cite>diff_drive_controller</cite> directly, without sensor fusion from the EKF.</p>
</section>
<section id="canopen-motor-control-integration">
<h4>CANOpen Motor Control Integration<a class="headerlink" href="#canopen-motor-control-integration" title="Link to this heading"></a></h4>
<p>The EVAL-ADRD3161 motor control platform uses CANOpen for robust, real-time motor and device communication. The CANOpen configuration is managed through YAML files in the <code class="docutils literal notranslate"><span class="pre">config/motors</span></code> directory. Device Configuration Files (DCFs) are generated using the <code class="docutils literal notranslate"><span class="pre">cogen_dcf</span></code> tool, which processes EDS files and outputs DCFs for each node.</p>
<p>A typical CANOpen master configuration (<code class="docutils literal notranslate"><span class="pre">bus.yaml</span></code>) includes:</p>
<ul class="simple">
<li><p><strong>Master node</strong>: Handles the CAN bus, synchronization, and node management.</p></li>
<li><p><strong>Defaults</strong>: Common settings for all nodes (e.g., product code, heartbeat, PDO mappings).</p></li>
<li><p><strong>Nodes</strong>: Individual device definitions (motors), each with unique node IDs and scaling factors.</p></li>
</ul>
<p>Key options:</p>
<ul class="simple">
<li><p><strong>driver/package</strong>: Specifies the ROS2 CANOpen driver for each node.</p></li>
<li><p><strong>PDO mappings</strong>: Define which CANOpen objects are exchanged in real time.</p></li>
<li><p><strong>Scaling factors</strong>: Convert between device units and SI units for position/velocity.</p></li>
</ul>
<p>A simplified example of such configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">master</span><span class="p">:</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ros2_canopen::MasterDriver&quot;</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;canopen_master_driver&quot;</span>

<span class="nt">defaults</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dcf</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;adrd3161.eds&quot;</span>
<span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ros2_canopen::Cia402Driver&quot;</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;canopen_402_driver&quot;</span>

<span class="nt">nodes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">drive_left</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x16</span>

<span class="w">  </span><span class="nt">drive_right</span><span class="p">:</span>
<span class="w">    </span><span class="nt">node_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0x14</span>
</pre></div>
</div>
<p>For detailed information on configuring CANOpen devices in ROS2, refer to the <a class="icon link reference external" href="https://ros-industrial.github.io/ros2_canopen/manual/humble" target="_blank">ROS2 CANopen Stack documentation</a> and the <a class="icon link reference external" href="https://github.com/ros-industrial/ros2_canopen" target="_blank">ros2_canopen</a> GitHub repository.</p>
</section>
</section>
<section id="imu-inertial-measurement-unit">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">IMU (Inertial Measurement Unit)</a><a class="headerlink" href="#imu-inertial-measurement-unit" title="Link to this heading"></a></h3>
<p>The ADI IMU node publishes sensor data to the <cite>/imu</cite> topic using the following configuration:</p>
<dl class="simple">
<dt>Parameters:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt><strong>iio_context_string</strong>: <em>‘ip:localhost’</em></dt><dd><ul>
<li><p>Defines the connection method to the IMU device via Industrial I/O (IIO) framework</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>measured_data_topic_selection</strong>: <em>2</em></dt><dd><ul>
<li><p>Selects standard IMU message type for the <cite>/imu</cite> topic</p></li>
<li><p>Follows <a class="icon link reference external" href="http://docs.ros.org/en/noetic/api/sensor_msgs/html/msg/Imu.html" target="_blank">sensor_msgs/Imu</a> format</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>minimal_pub</strong>: <em>true</em></dt><dd><ul>
<li><p>If true, publishes only the standard IMU message without additional identification or diagnotics information</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Launch the IMU node using the above parameters</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_imu.launch.py
</pre></div>
</div>
<p>For additional configuration details, refer to the <a class="icon link reference external" href="https://github.com/analogdevicesinc/imu_ros2" target="_blank">adi_imu_ros2 documentation</a>.</p>
<div class="smaller admonition">
<p class="admonition-title">Note</p>
<p>The IMU node from the <cite>adi_imu_ros2</cite> package publishes angular velocities and linear accelerations, but NOT orientation (Quaternion) data in the standard ROS2 <cite>sensor_msgs/Imu</cite> format.
EKF (Extended Kalman Filter) is configured to use the IMU data for state estimation, see the <cite>ekf.yaml</cite> configuration file in the <cite>config</cite> directory:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">imu0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/imu</span>
<span class="nt">imu0_config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">              </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">              </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span>
<span class="w">              </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">   </span><span class="c1"># angular velocity in Z (vyaw)</span>
<span class="w">              </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w">  </span><span class="nv">false</span><span class="p p-Indicator">]</span><span class="w">  </span><span class="c1"># linear acceleration in X, Y</span>
</pre></div>
</div>
<p>The <cite>imu_filter_madgwick</cite> node from the <a class="icon link reference external" href="https://github.com/CCNYRoboticsLab/imu_tools" target="_blank">imu_tools</a> can be used to fuse raw IMU data and compute orientation (Quaternion), publishing the result to <cite>/imu/data</cite>.
The node subscribes to <cite>/imu/data_raw</cite> (containing angular velocities and linear accelerations) and outputs a standard <cite>sensor_msgs/Imu</cite> message with orientation.
See this launch file for reference: <a class="icon link reference external" href="https://github.com/analogdevicesinc/imu_ros2/blob/humble/launch/imu_with_madgwick_filter_rviz.launch.py" target="_blank">imu_with_madgwick_filter</a>.</p>
</div>
<p>The IMU is mounted to the robot using a fixed joint as defined in the URDF:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;joint</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;imu_joint&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;parent</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;child</span><span class="w"> </span><span class="na">link=</span><span class="s">&quot;imu_link&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;0.133 -0.01 ${wheel_radius}&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;0 ${pi} ${-pi/2}&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></div>
</div>
<p>This means the IMU is positioned 0.133 m forward, -0.01 m to the left, and at the height of the wheel radius from the <em>base_link</em> (robot center at ground-level), with a rotation of (0, π, -π/2) radians.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../../../_images/imu_link.png"><img alt="IMU coordinate frame visualization" src="../../../../_images/imu_link.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 1 </span><span class="caption-text">IMU coordinate frame as mounted on the robot platform. The axes (see <em>base_link</em>) follow the ROS REP-103 convention: X (red) forward, Y (green) left, Z (blue) up.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="time-of-flight-camera">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Time-of-Flight Camera</a><a class="headerlink" href="#time-of-flight-camera" title="Link to this heading"></a></h3>
<p>ADI’s EVAL-ADTF3175D-NXZ ToF sensor is used in this AMR setup to provide depth perception. For this configuration, only depth images are published and used; amplitude (AB), confidence, and point cloud outputs are disabled.
The node captures depth frames from the sensor using the <a class="icon link reference external" href="https://github.com/analogdevicesinc/ToF/" target="_blank">ADI ToF SDK</a> APIs and publishes them as ROS topics.</p>
<dl>
<dt>Example Python launch code:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">adi_3dtof_node</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
    <span class="n">PythonLaunchDescriptionSource</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_3dtof_adtf31xx_dir</span><span class="p">,</span> <span class="s1">&#39;launch&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;adi_3dtof_adtf31xx_launch.py&#39;</span><span class="p">)</span>
    <span class="p">),</span>
    <span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;arg_enable_depth_publish&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span>  <span class="c1"># Enable depth image publishing for LaserScan conversion</span>
        <span class="s2">&quot;arg_enable_ab_publish&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arg_enable_conf_publish&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arg_enable_point_cloud_publish&quot;</span><span class="p">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arg_input_sensor_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>        <span class="c1"># Input mode, `0:Real Time Sensor`</span>
        <span class="s2">&quot;arg_input_sensor_ip&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arg_encoding_type&quot;</span><span class="p">:</span> <span class="s2">&quot;16UC1&quot;</span><span class="p">,</span>        <span class="c1"># Encoding types `mono16` or `16UC1`</span>
    <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>To start the ToF camera and convert depth images to LaserScan format, use the following launch command:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_tof.launch.py
</pre></div>
</div>
</div></blockquote>
<p><strong>Important:</strong> Run <code class="docutils literal notranslate"><span class="pre">~/Workspace/media_config_16D_16AB_8C.sh</span></code> outside the container before starting the camera.</p>
<p>The camera system consists of two main components:</p>
<p><strong>Camera Node</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Publishes depth images (<cite>/cam1/depth_image</cite>)</dt><dd><ul>
<li><p>Values in millimeters</p></li>
<li><p>Format: 16UC1</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Publishes camera calibration (<cite>/cam1/camera_info</cite>)</dt><dd><ul>
<li><p>Contains distortion model and intrinsic parameters</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Depth to LaserScan Node</strong></p>
<ul class="simple">
<li><p>Publishes 2D laser scan data (<cite>/cam1/scan</cite>)</p></li>
<li><p>Converts depth images to LaserScan format</p></li>
<li><p>Uses camera calibration for accurate transformations</p></li>
</ul>
<p>For detailed implementation and configuration, refer to the following resources:</p>
<ul class="simple">
<li><p><a class="icon link reference external" href="https://github.com/analogdevicesinc/adi_3dtof_adtf31xx/tree/v2.1.0" target="_blank">ADI ToF Camera ROS2 package and documentation</a></p></li>
<li><p><a class="icon link reference external" href="https://github.com/ros-perception/depthimage_to_laserscan/tree/ros2" target="_blank">Depth to LaserScan ROS2 package and documentation</a></p></li>
</ul>
<p><strong>Depth to LaserScan Parameters</strong></p>
<p>Current parameters used <code class="docutils literal notranslate"><span class="pre">depthimage_to_laserscan/cfg/param.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">depthimage_to_laserscan</span><span class="p">:</span>
<span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scan_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.033</span>
<span class="w">    </span><span class="nt">range_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">range_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">    </span><span class="nt">scan_height</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span><span class="w">        </span><span class="c1"># image height x width = 512 x 512</span>
<span class="w">    </span><span class="nt">scan_offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.6953125</span><span class="w">  </span><span class="c1"># [512 / 2 (center) + 100 (offset)] / 512</span>
<span class="w">    </span><span class="nt">output_frame</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cam1_adtf31xx&quot;</span>
</pre></div>
</div>
<p>The camera’s position relative to the robot base is defined in <code class="docutils literal notranslate"><span class="pre">urdf/camera.xacro</span></code>. Ensure the transform between <code class="docutils literal notranslate"><span class="pre">cam1_adtf31xx</span></code> and <code class="docutils literal notranslate"><span class="pre">base_link</span></code> frames is correctly specified for accurate sensor fusion and navigation.</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../../../_images/fig_tof_tf.png"><img alt="ToF Camera coordinate frame visualization" src="../../../../_images/fig_tof_tf.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Figure 2 </span><span class="caption-text">ToF Camera coordinate frame as mounted on the robot platform. For the current depth to LaserScan configuration, the camera is positioned at the front center of the robot chassis, slightly above the ground.
The camera is rotated by π radians around the X-axis to align the Laser Scan with the robot’s forward direction, as required by the current <a class="icon link reference external" href="https://github.com/ros-perception/depthimage_to_laserscan/tree/ros2" target="_blank">depthimage_to_laserscan</a> node.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The relevant URDF/Xacro snippet for the camera’s pose is:</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;origin</span><span class="w"> </span><span class="na">xyz=</span><span class="s">&quot;${chassis_length / 2} 0 0.055&quot;</span><span class="w"> </span><span class="na">rpy=</span><span class="s">&quot;${pi} 0 0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w"> </span><span class="cm">&lt;!-- rotated for correct depthimage_to_laserscan alignment --&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Depth to LaserScan Git Versioning</strong></p>
<p>The current version of the <cite>depthimage_to_laserscan</cite> package is based on the <cite>ros2</cite> branch of the <a class="icon link reference external" href="https://github.com/ros-perception/depthimage_to_laserscan/tree/ros2" target="_blank">ros-perception</a> repository, and includes features from the following pull requests:</p>
<ul class="simple">
<li><p><a class="icon link reference external" href="https://github.com/ros-perception/depthimage_to_laserscan/pull/90" target="_blank">PR #90</a> (Update DepthImageToLaserScan with distortion model)</p></li>
<li><p><a class="icon link reference external" href="https://github.com/ros-perception/depthimage_to_laserscan/pull/80" target="_blank">PR #80</a> (scan_offset parameter for ROS2)</p></li>
</ul>
<p>Both PRs are merged into the <cite>ros2</cite> branch of the currently used <a class="icon link reference external" href="https://github.com/laurent-19/depthimage_to_laserscan/tree/ros2" target="_blank">depthimage_to_laserscan</a> forked repository.</p>
</section>
<section id="remote-control-interface">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Remote Control Interface</a><a class="headerlink" href="#remote-control-interface" title="Link to this heading"></a></h3>
<p>The CRSF Node is a ROS 2 node designed to interface with an CRSF transceiver, enabling remote control capabilities for robotic platforms. It integrates joystick input handling, battery telemetry, safety killswitch logic, and elevator/lifter control.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start joystick control</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_crsf.launch.py
</pre></div>
</div>
<p><strong>Remote Control Input (Joystick)</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Processes joystick commands from an RC transmitter via the CRSF protocol</p></li>
<li><p>Connects to the CRSF transceiver over serial (/dev/ttymxc3, 420000 baud)</p></li>
<li><p>Publishes velocity commands to <code class="docutils literal notranslate"><span class="pre">/cmd_vel_joy</span></code> (geometry_msgs/Twist) and <code class="docutils literal notranslate"><span class="pre">/cmd_vel_joy_stamped</span></code> (geometry_msgs/TwistStamped)</p></li>
</ul>
</div></blockquote>
<p><strong>Safety Killswitch System</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Implements an emergency stop using Switch SA on the transmitter</p></li>
<li><p>State machine: INIT → KILL → RUN → KILL, requiring intentional activation before operation</p></li>
<li><p>Automatically enters kill mode on CRSF signal loss (50+ empty reads)</p></li>
<li><p>Publishes killswitch state to <code class="docutils literal notranslate"><span class="pre">/killswitch</span></code> (std_msgs/Bool)</p></li>
</ul>
</div></blockquote>
<p><strong>Battery Telemetry</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Monitors and reports battery voltage via CANopen SDO</p></li>
<li><p>Displays voltage and remaining capacity on the RC transmitter</p></li>
<li><p>Supports 3-cell battery configuration (3.0V - 4.2V per cell)</p></li>
</ul>
</div></blockquote>
<p><strong>Elevator/Lifter Control</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Controls a lifting mechanism using Switch SB on the transmitter</p></li>
<li><p>Commands:
- SB Up (-90): Lift up (command 1)
- SB Center (0): Hold (command 0)
- SB Down (+90): Lift down (command 2)</p></li>
<li><p>Uses <code class="docutils literal notranslate"><span class="pre">/elevator_to_robot</span></code> service (adrd_demo_ros2/LiftGPIO)</p></li>
</ul>
</div></blockquote>
<p><strong>State Machine</strong></p>
<ul class="simple">
<li><p><strong>INIT</strong>: Startup, waits for killswitch activation</p></li>
<li><p><strong>KILL</strong>: Safe state, motors stopped, lift lowered</p></li>
<li><p><strong>RUN</strong>: Active, accepts joystick commands</p></li>
</ul>
<p><strong>Channel Mapping</strong></p>
<ul class="simple">
<li><p><strong>Right Stick (rx, ry)</strong>: Robot movement</p></li>
<li><p><strong>Switch SA</strong>: Killswitch</p></li>
<li><p><strong>Switch SB</strong>: Lifter control</p></li>
</ul>
<p><strong>Command Multiplexer</strong></p>
<p>The command multiplexer node (<cite>twist_mux</cite>) combines multiple velocity command sources into a single output. It subscribes to:</p>
<ul class="simple">
<li><p><cite>/cmd_vel_joy</cite> (from the CRSF node)</p></li>
<li><p><cite>/cmd_vel_nav</cite> (from the Navigation2 stack)</p></li>
<li><p><cite>/cmd_vel_keyboard</cite> (from the Keyboard teleop - optional)</p></li>
</ul>
<p>It publishes the selected command to <cite>/diff_drive_controller/cmd_vel_unstamped</cite>, which is used by the drive system.</p>
</section>
<section id="mapping-and-localization">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Mapping and Localization</a><a class="headerlink" href="#mapping-and-localization" title="Link to this heading"></a></h3>
<p>The SLAM Toolbox provides both mapping and localization capabilities, while AMCL (Adaptive Monte Carlo Localization) offers particle filter-based localization for pre-existing maps.</p>
<p><strong>SLAM Toolbox for Mapping and Localization</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start SLAM for mapping or localization</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>online_async_launch.py
</pre></div>
</div>
<p>The SLAM Toolbox can operate in two modes, configurable in <code class="docutils literal notranslate"><span class="pre">config/mapper_params_online_async.yaml</span></code>:</p>
<ul class="simple">
<li><p><strong>Mapping mode</strong>: Creates new maps from sensor data</p></li>
<li><p><strong>Localization mode</strong>: Uses existing maps for pose estimation</p></li>
</ul>
<p>To use a pre-existing map:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localization</span>
<span class="nt">map_file_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/runner/ros_ws/src/adrd_demo_ros2/maps/&lt;map_name&gt;</span>
</pre></div>
</div>
<p>More details on SLAM Toolbox implementation and configuration can be found in the <a class="icon link reference external" href="https://github.com/SteveMacenski/slam_toolbox" target="_blank">SLAM Toolbox documentation</a>.</p>
<p><strong>AMCL Localization (Used in Nav Demo)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start AMCL localization</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>localization_launch.py
</pre></div>
</div>
<div style="text-align: center;">
    <video width="400" controls style="display: block; margin: 0 auto;">
         <source src="../figures/fig_amcl.mp4" type="video/mp4">
    </video>
    <p style="text-align: center; font-style: italic; margin-top: 10px;">Live AMCL localization process visualization.</p>
</div><p>Monte Carlo localization estimates the robot’s pose by subscribing to:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/odom</span></code>: Robot odometry frame. Transform from <cite>/odom</cite> to <cite>/base_link</cite> is provided by the <cite>robot_localization</cite> or <cite>diff_drive_controller</cite> node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/cam1/scan</span></code>: Processed LaserScan depth data from ToF camera</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tf</span></code>: Transform tree for coordinate frame relationships</p></li>
</ul>
<p>Publishes estimated pose to <code class="docutils literal notranslate"><span class="pre">/amcl_pose</span></code> (geometry_msgs/PoseWithCovarianceStamped), that can be tracked in RViz or by other nodes.</p>
<p>The AMCL parameters are configured in <code class="docutils literal notranslate"><span class="pre">config/nav2_params.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">amcl</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">use_sim_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="w">    </span><span class="nt">alpha1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># rad/s -&gt; rad/s, covariance from rotation to rotation</span>
<span class="w">    </span><span class="nt">alpha2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># rad/s -&gt; m/s, covariance from translation to rotation</span>
<span class="w">    </span><span class="nt">alpha3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># m/s -&gt; rad/s, covariance from rotation to translation</span>
<span class="w">    </span><span class="nt">alpha4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># m/s -&gt; m/s, covariance from translation to translation</span>
<span class="w">    </span><span class="c1"># alpha5 irrelevant for diff drive</span>
<span class="w">    </span><span class="nt">base_frame_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;base_link&quot;</span>
<span class="w">    </span><span class="nt">beam_skip_distance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># reduced from 0.5</span>
<span class="w">    </span><span class="nt">beam_skip_error_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.9</span>
<span class="w">    </span><span class="nt">beam_skip_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">do_beamskip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">global_frame_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;map&quot;</span>
<span class="w">    </span><span class="nt">lambda_short</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">    </span><span class="nt">laser_likelihood_max_dist</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1"># 5cm bubble around obstacles</span>
<span class="w">    </span><span class="nt">laser_max_range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5.0</span>
<span class="w">    </span><span class="nt">laser_min_range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">laser_model_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;likelihood_field&quot;</span>
<span class="w">    </span><span class="nt">max_beams</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">180</span><span class="w">        </span><span class="c1"># number of beams/rays used in the particle filter scan</span>
<span class="w">    </span><span class="nt">max_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">700</span><span class="w">    </span><span class="c1"># max number of particles for localization</span>
<span class="w">    </span><span class="nt">min_particles</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span><span class="w">    </span><span class="c1"># min number of particles for localization</span>
<span class="w">    </span><span class="nt">odom_frame_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;odom&quot;</span>
<span class="w">    </span><span class="nt">pf_err</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.02</span>
<span class="w">    </span><span class="nt">pf_z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.99</span>
<span class="w">    </span><span class="nt">dist_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.3</span>
<span class="w">    </span><span class="nt">recovery_alpha_fast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span><span class="w">    </span><span class="c1"># increased from 0.0</span>
<span class="w">    </span><span class="nt">recovery_alpha_slow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0001</span><span class="w"> </span><span class="c1"># increased from 0.0</span>
<span class="w">    </span><span class="nt">resample_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">robot_model_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nav2_amcl::DifferentialMotionModel&quot;</span>
<span class="w">    </span><span class="nt">save_pose_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">sigma_hit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.02</span><span class="w">  </span><span class="c1"># 2cm stddev on distances</span>
<span class="w">    </span><span class="nt">tf_broadcast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">transform_tolerance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
<span class="w">    </span><span class="nt">update_min_a</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w">   </span><span class="c1"># 5deg per update</span>
<span class="w">    </span><span class="nt">update_min_d</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span><span class="w">   </span><span class="c1"># 1cm per update</span>
<span class="w">    </span><span class="nt">z_hit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">z_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="w">    </span><span class="nt">z_rand</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">z_short</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="w">    </span><span class="nt">scan_topic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/cam1/scan</span>

<span class="w">    </span><span class="nt">set_initial_pose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">initial_pose</span><span class="p">:</span>
<span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">yaw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1.5708</span><span class="w">  </span><span class="c1"># -90 degrees</span>
</pre></div>
</div>
<p>Key parameters for tuning localization performance:</p>
<ul class="simple">
<li><p><strong>Particle filter settings</strong>: <code class="docutils literal notranslate"><span class="pre">min_particles</span></code> (500) and <code class="docutils literal notranslate"><span class="pre">max_particles</span></code> (700) define the range of particles used for pose estimation</p></li>
<li><p><strong>Update thresholds</strong>: <code class="docutils literal notranslate"><span class="pre">update_min_d</span></code> (1cm) and <code class="docutils literal notranslate"><span class="pre">update_min_a</span></code> (5°) determine when localization updates occur</p></li>
<li><p><strong>Laser model</strong>: Uses <code class="docutils literal notranslate"><span class="pre">likelihood_field</span></code> model with <code class="docutils literal notranslate"><span class="pre">max_beams</span></code> (180) for efficient processing</p></li>
<li><p><strong>Motion model</strong>: Configured for differential drive with noise parameters (<code class="docutils literal notranslate"><span class="pre">alpha1-4</span></code>) tuned for the platform</p></li>
<li><p><strong>Initial pose</strong>: Set to origin with of the provided map.</p></li>
</ul>
<p>Detailed information on AMCL parameters can be found in the <a class="icon link reference external" href="https://docs.nav2.org/configuration/packages/configuring-amcl.html" target="_blank">Navigation2 documentation</a>.</p>
<p>The implementation of the AMCL node can be found in the <a class="icon link reference external" href="https://github.com/ros-navigation/navigation2/tree/main/nav2_amcl" target="_blank">nav2_amcl</a> package, which is part of the Navigation2 stack.</p>
<p>An intuitive visualization of the AMCL localization process is explained <a class="icon link reference external" href="https://www.mathworks.com/videos/autonomous-navigation-part-2-understanding-the-particle-filter-1594903924427.html" target="_blank">here</a>.</p>
</section>
<section id="autonomous-navigation">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Autonomous Navigation</a><a class="headerlink" href="#autonomous-navigation" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start Navigation2 stack</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>navigation_launch.py
</pre></div>
</div>
<p>The navigation launch provides:</p>
<p><strong>Behavior Tree Navigator (bt_navigator)</strong></p>
<ul class="simple">
<li><p><strong>Purpose</strong>: High-level decision making and behavior coordination</p></li>
<li><dl class="simple">
<dt><strong>Features</strong>:</dt><dd><ul>
<li><p>Uses default behavior trees for navigation and recovery</p></li>
<li><p>Plugin library for all navigation behaviors</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Controller Server</strong></p>
<ul>
<li><p><strong>Purpose</strong>: Local path following and obstacle avoidance</p></li>
<li><p><strong>DWB Local Planner Configuration</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Velocity limits: 0.4 m/s max linear, 0.18 m/s max speed</p></li>
<li><p>Acceleration: 0.2 m/s² acceleration, -0.5 m/s² deceleration</p></li>
<li><p>Trajectory sampling: 20 linear × 20 angular samples</p></li>
<li><p>Goal tolerance: 10cm position, ~0.6° orientation</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Costmap Configuration</strong></p>
<ul>
<li><p><strong>Local Costmap (Real-time obstacle avoidance)</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Size: 3m × 3m rolling window around robot</p></li>
<li><p>Resolution: 5cm grid cells</p></li>
<li><p>Update rate: 5Hz updates, 2Hz publishing</p></li>
<li><p>Layers: Inflation layer (1cm safety buffer)</p></li>
</ul>
</div></blockquote>
</li>
<li><p><strong>Global Costmap (Full map planning)</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Frame: Uses complete map coordinate system</p></li>
<li><p>Layers: Static layer (pre-built map), Obstacle layer (dynamic obstacles), Inflation layer (1cm safety margin)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Path Planning (planner_server)</strong></p>
<ul class="simple">
<li><p><strong>Algorithm</strong>: Navfn (Dijkstra-based) planner</p></li>
<li><p><strong>Tolerance</strong>: 10cm path planning accuracy</p></li>
<li><p><strong>Features</strong>: Allows planning through unknown areas, maintains goal orientation approach</p></li>
</ul>
<p><strong>Path Smoothing (smoother_server)</strong></p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Creates smoother, more natural robot trajectories</p></li>
</ul>
<p><strong>Recovery Behaviors (behavior_server)</strong></p>
<ul>
<li><p><strong>Available behaviors for error recovery</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Spin: Rotate in place to clear confusion</p></li>
<li><p>Backup: Reverse 5cm to escape tight spots</p></li>
<li><p>Drive on heading: Move straight in specific direction</p></li>
<li><p>Wait: Pause and reassess situation</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p><strong>Waypoint Following (waypoint_follower)</strong></p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Navigate through multiple sequential goals</p></li>
</ul>
<p><strong>Velocity Smoothing (velocity_smoother)</strong></p>
<ul class="simple">
<li><p><strong>Purpose</strong>: Creates smooth acceleration/deceleration profiles</p></li>
</ul>
<p>Nav2 subscribes to <cite>/odom</cite>, <cite>/cam1/scan</cite>, and <cite>/tf</cite> topics, and publishes commands to <cite>/cmd_vel_nav</cite> (smoothed to <cite>/cmd_vel</cite>).</p>
<div style="text-align: center;">
    <video width="400" controls style="display: block; margin: 0 auto;">
         <source src="../figures/fig_amcl.mp4" type="video/mp4">
    </video>
    <p style="text-align: center; font-style: italic; margin-top: 10px;">Live Navigation visualization.</p>
</div><p>The full documentation for the Navigation2 stack can be found in the <a class="icon link reference external" href="https://docs.nav2.org/index.html" target="_blank">Navigation2 documentation</a> and on the <a class="icon link reference external" href="https://github.com/ros-navigation/navigation2" target="_blank">Navigation2 GitHub repository</a>.</p>
</section>
<section id="high-level-control-commander-nodes">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">High-Level Control (Commander Nodes)</a><a class="headerlink" href="#high-level-control-commander-nodes" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run a commander node</span>
ros2<span class="w"> </span>run<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>&lt;node_name&gt;.py
</pre></div>
</div>
<p>Available commander nodes:</p>
<ul class="simple">
<li><p><strong>demo.py</strong>: Basic navigation demo with elevator integration</p></li>
<li><p><strong>waypoint_follower.py</strong>: Follows predefined waypoint sequences</p></li>
<li><p><strong>elevator_server.py</strong>: Simulates elevator control responses</p></li>
</ul>
<p>Commander nodes provide:</p>
<ul class="simple">
<li><p>Integration with Nav2’s <code class="docutils literal notranslate"><span class="pre">BasicNavigator</span></code></p></li>
<li><p>Waypoint definition and sequencing</p></li>
<li><p>Robot pose management</p></li>
<li><p>Task coordination</p></li>
<li><p>Elevator integration</p></li>
</ul>
<p>More details on the commander nodes and examples on how to interact with the ROS2 system can be found in the <a class="reference external" href="ros2-examples.html">ROS2 Examples</a> documentation.</p>
</section>
</section>
<section id="visualization-and-manual-control">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Visualization and Manual Control</a><a class="headerlink" href="#visualization-and-manual-control" title="Link to this heading"></a></h2>
<section id="rviz-visualization">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">RViz Visualization</a><a class="headerlink" href="#rviz-visualization" title="Link to this heading"></a></h3>
<p>Launch RViz with the preconfigured layout:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>rviz2<span class="w"> </span>rviz2<span class="w"> </span>-d<span class="w"> </span>src/adrd_demo_ros2/rviz/main.rviz
</pre></div>
</div>
<div class="smaller admonition">
<p class="admonition-title">Note</p>
<p>Fixed frame selection impacts data visibility:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/base_link</span></code>: Only robot-relative data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/odom</span></code>: Robot and odometry data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/map</span></code>: All data when mapping/localization active</p></li>
</ul>
</div>
<p><strong>TF Tree Structure:</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>map
└── odom
    └── base_link
        ├── base_footprint
        ├── camera_link
        ├── wheel_*_link
        └── imu_link
</pre></div>
</div>
<p>Select the appropriate frame based on active components to avoid transform errors.</p>
</section>
<section id="manual-control">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">Manual Control</a><a class="headerlink" href="#manual-control" title="Link to this heading"></a></h3>
<p>For manual keyboard control, you can use the teleop launch file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>teleop_launch.py
</pre></div>
</div>
<p>This launch file provides:</p>
<dl class="simple">
<dt><strong>Teleop Keyboard Node</strong></dt><dd><ul class="simple">
<li><p>Enables keyboard control of the robot</p></li>
<li><p>Publishes velocity commands to <cite>/cmd_vel_keyboard</cite></p></li>
<li><p>Runs in a separate terminal window (xterm)</p></li>
</ul>
</dd>
<dt><strong>Killswitch Keyboard Node</strong></dt><dd><ul class="simple">
<li><p>Provides emergency stop functionality via keyboard</p></li>
<li><p>Runs in a separate terminal window</p></li>
<li><p>Safety control independent of joystick</p></li>
</ul>
</dd>
</dl>
<p>Alternatively, you can run keyboard teleop directly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2<span class="w"> </span>run<span class="w"> </span>teleop_twist_keyboard<span class="w"> </span>teleop_twist_keyboard<span class="w"> </span>--ros-args<span class="w"> </span>-r<span class="w"> </span>cmd_vel:<span class="o">=</span>/cmd_vel_keyboard
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Important</p>
<p>Make sure you launched the motor system first before using keyboard teleop.</p>
</div>
</section>
</section>
<section id="quick-start">
<h2><a class="toc-backref" href="#id16" role="doc-backlink">Quick Start</a><a class="headerlink" href="#quick-start" title="Link to this heading"></a></h2>
<p>To quickly get the robot running, you can create a bash script to start all nodes sequentially. Here’s the recommended startup sequence:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Start motor control system</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_motors.launch.py<span class="w"> </span>can_iface:<span class="o">=</span>can0<span class="w"> </span><span class="p">&amp;</span>
sleep<span class="w"> </span><span class="m">20</span>

<span class="c1"># Start telemetry and remote control</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_crsf.launch.py<span class="w"> </span><span class="p">&amp;</span>
sleep<span class="w"> </span><span class="m">10</span>

<span class="c1"># Start sensor nodes</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_imu.launch.py<span class="w"> </span><span class="p">&amp;</span>
sleep<span class="w"> </span><span class="m">10</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>just_tof.launch.py<span class="w"> </span><span class="p">&amp;</span>
sleep<span class="w"> </span><span class="m">10</span>

<span class="c1"># Start localization</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>localization_launch.py<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>At this point, you can move the robot around using the remote control and observe how it localizes in RViz. The robot will track its position using AMCL particle filter localization.</p>
<p>To enable autonomous navigation, start the navigation stack:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start autonomous navigation</span>
ros2<span class="w"> </span>launch<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>navigation_launch.py<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>Once navigation is running, you can publish goal poses from RViz using the “2D Goal Pose” tool. The robot will compute an optimal path and autonomously navigate to the target location.</p>
<p>For high-level autonomous behavior, start a commander node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start autonomous mission commander</span>
ros2<span class="w"> </span>run<span class="w"> </span>adrd_demo_ros2<span class="w"> </span>demo_run.py
</pre></div>
</div>
<p>The commander node provides a demo script for robot navigation and lift control with the following features:</p>
<ul class="simple">
<li><p><strong>LiftClientAsync</strong>: Asynchronous ROS2 service client for controlling a lift via GPIO</p></li>
<li><p><strong>Waypoint</strong>: Helper class for storing navigation waypoints with orientation and lift actions</p></li>
<li><p><strong>PoseTracker</strong>: Node that tracks robot pose, navigates through waypoints, and coordinates lift actions</p></li>
<li><p><strong>Navigation Integration</strong>: Publishes navigation goals, sends velocity commands, and interacts with the lift service</p></li>
</ul>
<p>See the next ROS2 Examples section for more details on how to interact with the system, refer to the <a class="reference external" href="ros2-examples.html">ROS2 Examples</a> documentation, which provides examples of how to interact with the robot using the available commander nodes and other ROS2 features.
For more information on the AD-R1M ROS2 architecture, refer to the <a class="icon link reference external" href="https://github.com/adi-innersource/adrd_demo_ros2" target="_blank">AD-R1M ROS2 GitHub repository</a>.</p>
</section>
</section>


          </div>
              <div class="related">
                &nbsp;
    <a href="ros2-examples.html" title="Previous document (Alt+Shift+LeftArrow)" class="prev">AD-R1M ROS2 examples</a>
    <a href="../advanced-usage.html" title="Next document (Alt+Shift+RightArrow)" class="next">AD-R1M Advanced Usage</a>
              </div>
          
        </div>
      </div>
  </div>

  <label id="cancel-area-show-toc" for="input-show-toc"></label>
  <label id="cancel-area-show-localtoc" for="input-show-localtoc"></label>
    <footer>
      &#169;2025, Analog Devices, Inc.
      
      |
      Made with <a href="https://www.sphinx-doc.org/">Sphinx</a>
      &amp; <a href="https://github.com/analogdevicesinc/doctools">Doctools</a>
      
    </footer>
  </body>
</html>